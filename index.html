<html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TP Final Simulación</title>
    <link href="node_modules/bootstrap/dist/css/bootstrap.css" rel="stylesheet">
    <link href="src/style.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto+Slab" rel="stylesheet">
    <link href="node_modules/rangeslider.js/dist/rangeslider.css" rel="stylesheet">
    <link href="node_modules/dygraphs/dist/dygraph.css" rel="stylesheet" type="text/css">

</head>

<body>
    <script src="node_modules/jquery/dist/jquery.js"></script>
    <script src="node_modules/rangeslider.js/dist/rangeslider.js"></script>
    <script src="src/rangeslider-script.js"></script>
    <script src="node_modules/d3/dist/d3.js"></script>
    <script src="node_modules/dygraphs/dist/dygraph.js"></script>


    <!-- <script src="https://d3js.org/d3.v4.min.js"></script> -->
    <!-- <script>
        function showConsole(value) {
            console.log(value);
        }
    </script> -->

    <!-- comentario de prueba-->

    <section id="header">
        <div class="row row-title">
            <div class="col">
                <h1 class="title">Calculadora de inversiones</h1>
            </div>
        </div>
        <div class="row row-belowtitle"></div>
    </section>
    <section class="container-fluid">
        <div class="row">
            <div class="col-4">
                <h2 class="alt-title offset-1">Opciones</h2>
                <div class="slider">

                    <div class="row">
                        <div class="col-11 offset-1">
                            <p>Monto a invertir (pesos)</p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-4 offset-1">
                            <input type="range" min="100" max="100000" value="10000" step="100" data-rangeslider>
                        </div>
                        <div class="col-4">
                            <input type="number" id="monto" class="form-control output cambiar" onchange="calcular2()">
                        </div>
                    </div>
                </div>
                <div class="slider">
                    <div class="row">
                        <div class="col-11 offset-1">
                            <p>Plazo de inversiones (meses)</p>
                        </div>

                    </div>
                    <div class="row">
                        <div class="col-4 offset-1">
                            <input type="range" class="" min="1" max="24" value="3" data-rangeslider>
                        </div>
                        <div class="col-4">
                            <input type="number" id="meses" class="form-control output cambiar" onchange="calcular2()">
                        </div>
                    </div>
                </div>

                <div class="row">

                    <div class="col-6 offset-1">
                        <h2 class="alt-title">Alternativas</h2>
                        <p>
                            <input type="checkbox" checked="checked" class="checkbox check1" id="0" onclick="changeStatus(this)">
                            <label for="0">Dólares</label>
                        </p>
                        <p>
                            <input type="checkbox" class="checkbox " checked="checked" id="1" onclick="changeStatus(this)">
                            <label for="1">Fondos de Inversión</label>
                        </p>
                        <p>
                            <input type="checkbox" class="checkbox " checked="checked" id="2" onclick="changeStatus(this)">
                            <label for="2">Plazo Fijo</label>
                        </p>
                        <p>
                            <input type="checkbox" class="checkbox " checked="checked" id="3" onclick="changeStatus(this)">
                            <label for="3">LEBAC</label>
                        </p>

                    </div>
                </div>
                <div class="row">
                    <div class="col-4 offset-2">
                        <p>
                            <button class="btn-primary btn-mati" onclick="calcular2(this)">Calcular</button>
                        </p>

                    </div>
                </div>
                <div class="row">
                    <div class="col-4 offset-2">
                        <p>
                            <input type="checkbox" class="checkbox " checked="checked" id="crisis">
                            <label for="3">Crisis</label>
                        </p>
                        <!-- <p>g.visibility() =
                            <span id="visibility"></span>
                        </p> -->
                    </div>
                </div>
            </div>
            <div class="col-7">
                <div class="row">
                    <div class="col600 col-12" id="graph"></div>
                    <div class="col-12 tabla">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th scope="col"></th>
                                    <th scope="col">Capital Final</th>
                                    <th scope="col">Ganancia</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th scope="row">Dólar</th>
                                    <td id="dolarcap"></td>
                                    <td id="dolargan"></td>
                                </tr>
                                <tr>
                                    <th scope="row">Fondos de Inversión</th>
                                    <td id="fcicap"></td>
                                    <td id="fcigan"></td>
                                </tr>
                                <tr>
                                    <th scope="row">Plazo Fijo</th>
                                    <td id="pfcap"></td>
                                    <td id="pfgan"></td>
                                </tr>
                                <tr>
                                    <th scope="row">LEBAC</th>
                                    <td id="lebaccap"></td>
                                    <td id="lebacgan"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <!-- <svg width="960" height="500"></svg> -->
            </div>
            <!-- <div id="graph"></div> -->
        </div>

    </section>
    <section class="container-fluid" id="graficos1">
        <div class="row">
            <div class="col-6 col600">
                <div class="row">
                    <h3>Evolución del dólar</h3>
                </div>
                <div class="row">
                    <div id="dolargraf"></div>
                </div>
            </div>
            <div class="col-6 col600" >
                <div class="row">
                    <h3>Evolución de las tasas de Interés</h3>
                </div>
                <div class="row">
                    <div id="tasasgraf"></div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-6 col600"  >
                <div class="row">
                    <h3>Evolución de las tasas de LEBAC</h3>
                </div>
                <div class="row">
                    <div id="lebacgraf"></div>
                </div>
            </div>
            <div class="col-6 col600" >
                <div class="row">
                    <h3>Evolución de las cuotapartes de un Fondo de Inversión</h3>
                </div>
                <div class="row">
                    <div id="fcigraf"></div>
                </div>
            </div>
        </div>
    </section>


    <script>


        $("table").hide();
        $('#graficos1').hide();

       

        function getFormatedData(dataArray) {
            var dolarHoy = dataArray[0].valorDolar;
            var FCIhoy = dataArray[0].valorFondosInv;
            var tasashoy = dataArray[0].valorTasaInt;
            var lebachoy = dataArray[0].valorLebac;
            var inversionDolarHoy = $('#monto').val() / dolarHoy;
            var inversionFCIhoy = $('#monto').val() / FCIhoy;
            var inversionPFhoy = $('#monto').val();
            // var inversionPFhoy = $('#monto').val()* (1+(dataArray[0].valorTasaInt/100)/12);
            var inversionLebachoy = $('#monto').val();

            var r = "";
            var j = 1;
            for (var i = 0; i < $('#meses').val() * 30; i++) {
                r += dataArray[i].fecha;
                r += "," + inversionDolarHoy * dataArray[i].valorDolar;
                r += "," + inversionFCIhoy * dataArray[i].valorFondosInv;
                r += "," + inversionPFhoy;
                r += "," + inversionLebachoy;
                r += "\n";
                inversionPFhoy = inversionPFhoy * (1+(dataArray[j].valorTasaInt/100)/365);
                inversionLebachoy = inversionLebachoy * (1+(dataArray[j].valorLebac/100)/365);
                // if(i!=0){
                //     if(i%30 == 0){
                //     j = i;
                //     inversionPFhoy = inversionPFhoy * (1+(dataArray[j].valorTasaInt/100)/12);
                //     }    
                // }
                
            }

            console.log($('#crisis').is(':checked'));
            return r;
        }
        function getFormatedDataDolar(dataArray) {
            var r = "fecha,valor\n";
            for (var i = 0; i < $('#meses').val() * 30; i++) {
                r += dataArray[i].fecha;
                r += "," + dataArray[i].valorDolar;
                r += "\n";
            }
            return r;
        }
        function getFormatedDataFCI(dataArray) {
            var r = "fecha,valor\n";
            for (var i = 0; i < $('#meses').val() * 30; i++) {
                r += dataArray[i].fecha;
                r += "," + dataArray[i].valorFondosInv;
                r += "\n";
            }
            return r;
        }
        function getFormatedDataLebac(dataArray) {
            var r = "fecha,valor\n";
            for (var i = 0; i < $('#meses').val() * 30; i++) {
                r += dataArray[i].fecha;
                r += "," + dataArray[i].valorLebac;
                r += "\n";
            }
            return r;
        }
        function getFormatedDataTasa(dataArray) {

            var r = "fecha,valor\n";
            for (var i = 0; i < $('#meses').val() * 30; i++) {
                r += dataArray[i].fecha;
                r += "," + dataArray[i].valorTasaInt;
                r += "\n";
            }

            return r;
            
        }


        function calcular2() {
            $.ajax({

                url: "http://ec2-54-190-28-189.us-west-2.compute.amazonaws.com:3000/calcular",
                type: "get",
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                data: {
                    crisis: $('#crisis').is(':checked')
                },
                success: function (result) {
                    var enviar = getFormatedData(result);

                    var array = enviar.split(',');
                    var inversionTotalLebac = array.pop();
                    var inversionTotalPF = array.pop();
                    var inversionTotalFCI = array.pop();
                    var inversionTotalDolar = array.pop();

                    
                    var inversionTotal = [inversionTotalDolar,inversionTotalLebac,inversionTotalFCI,inversionTotalPF];

                    getInversionTotal(inversionTotal);

                    var dolarenviar = getFormatedDataDolar(result);
                    var tasaenviar = getFormatedDataTasa(result);
                    var fcienviar = getFormatedDataFCI(result);
                    var lebacenviar = getFormatedDataLebac(result);
                    calcular(enviar,dolarenviar,tasaenviar,fcienviar,lebacenviar);
                  
                }

            });
            $('#graficos1').show();

        }


        function loadTable(inversionTotal) {
            $("table").show();
            var inversionTotalD = inversionTotal[0];
            var inversionTotalL = inversionTotal[1];
            var inversionTotalF = inversionTotal[2];
            var inversionTotalP = inversionTotal[3];

            var inversionTotalD = Math.round(inversionTotalD * 100) / 100;
            var inversionTotalL = Math.round(inversionTotalL * 100) / 100;
            var inversionTotalF = Math.round(inversionTotalF * 100) / 100;
            var inversionTotalP = Math.round(inversionTotalP * 100) / 100;

            var gananciaD = inversionTotalD - $('#monto').val();
            gananciaD = Math.round(gananciaD * 100) / 100;

            var gananciaL = inversionTotalL - $('#monto').val();
            gananciaL = Math.round(gananciaL * 100) / 100;

            var gananciaF = inversionTotalF - $('#monto').val();
            gananciaF = Math.round(gananciaF * 100) / 100;

            var gananciaP = inversionTotalP - $('#monto').val();
            gananciaP = Math.round(gananciaP * 100) / 100;

            if ($('#0').is(":checked")) {
                $('#dolarcap').html("$" + inversionTotalD);
                $('#dolargan').html("$" + gananciaD);
            } else {
                $('#dolarcap').html("N/A");
                $('#dolargan').html("N/A");
            }
            if ($('#1').is(":checked")) {
                $('#fcicap').html("$" + inversionTotalF);
                $('#fcigan').html("$" + gananciaF);
            } else {
                $('#fcicap').html("N/A");
                $('#fcigan').html("N/A");
            }
            if ($('#2').is(":checked")) {
                $('#pfcap').html("$" + inversionTotalP);
                $('#pfgan').html("$" + gananciaP);
            } else {
                $('#pfcap').html("N/A");
                $('#pfgan').html("N/A");
            }
            if ($('#3').is(":checked")) {
                $('#lebaccap').html("$" + inversionTotalL);
                $('#lebacgan').html("$" + gananciaL);
            } else {
                $('#lebaccap').html("N/A");
                $('#lebacgan').html("N/A");
            }



        }

    </script>
    <script src="src/graphic.js"></script>
</body>

</html>